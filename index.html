<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>One Metadata to Rule Them All</title>

		<meta name="description" content="A framework for easily creating beautiful presentations using HTML">
		<meta name="author" content="Hakim El Hattab">

		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<link rel="stylesheet" href="css/reveal.min.css">
		<link rel="stylesheet" href="css/theme/default.css" id="theme">

		<!-- For syntax highlighting -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- If the query includes 'print-pdf', include the PDF print sheet -->
		<script>
			if( window.location.search.match( /print-pdf/gi ) ) {
				var link = document.createElement( 'link' );
				link.rel = 'stylesheet';
				link.type = 'text/css';
				link.href = 'css/print/pdf.css';
				document.getElementsByTagName( 'head' )[0].appendChild( link );
			}
		</script>

		<style type='text/css'>
			.reveal.has-parallax-background .backgrounds {
				opacity: 0.6;
			}

			.reveal section img {
				background-color: transparent;
				border: none;
				box-shadow: none;
				width: 90%;
			}

			table.gridtable {
				font-family: verdana,arial,sans-serif;
				font-size:11px;
				color:#333333;
				border-width: 1px;
				border-color: #666666;
				border-collapse: collapse;
			}
			table.gridtable th {
				border-width: 1px;
				padding: 8px;
				border-style: solid;
				border-color: #666666;
				background-color: #dedede;
			}
			table.gridtable td {
				border-width: 1px;
				padding: 8px;
				border-style: solid;
				border-color: #666666;
				background-color: #ffffff;
			}
		</style>
	</head>

	<body>
		<div class="reveal">

			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">
				<section data-background="images/one_ring.png" data-background-size="500px">
					<h1><p>One Metadata to Rule Them All</p></h1>
					<h3><p>NEARC - Groton, CT </p>
						<p>October 7, 2014</p>
					</h3>
					<h4><p>Sean Sweeney, GIS Programmer Analyst</p>
						<p>Rachel Sheketoff, Web Developer</p>
						<p>City of Cambridge, MA</p>
					</h4>
					<aside class="notes">
					  <p>When we recently built our new GIS website, we were searching for a way to better manage our 
					  metadata.  At the time we had a data maintenance book in Word documents, plus a separate HTML data 
					  dictionary for our old website in addition to the standard SDE metadata.  All of these were carrying 
					  similar information but needed to be edited individually.  With the prospect of posting some of our 
					  data on GitHub, ArcGIS Online, and our Socrata data portal, we were looking at even more places to edit.</p>

					  <p>In this presentation, we will demo our new data dictionary, which is generated directly from the XML 
					  metadata in our ArcSDE database, and we’ll show the process we used to build it.  We’ll also discuss 
					  our other ongoing efforts to consolidate our metadata into one single source.
					  </p>
					</aside>
				</section>

				<section>
					<img src='images/sde_metadata.png' alt='SDE' style='position: absolute; top: -10px; left: -10px; margin: 0px; border: none; max-width: none; max-height: none; z-index=10'/>
					<span class='fragment'>
						<img src='images/old_data_dictionary.png' alt='Data Dictionary' style='position: absolute; top: 0px; left: 0px; margin: 0px; border: none; max-width: none; max-height: none; z-index=20'/>
					</span>
					<span class='fragment'>
						<img src='images/old_data_maintenance.png' alt='Data Maintenance' style='position: absolute; top: 10px; left: 10px; margin: 0px; border: none; max-width: none; max-height: none; z-index=20'/>
					</span>
					<aside class="notes">
						<p>This is a problem I have been thinking about for a couple of years now.  At that time we had our
						SDE metadata plus our online data dictionary pages and our data maintenance pages, which were 
						Word documents.  Three separate things that needed to be maintained separately.
						</p>
					</aside>
				</section>

				<section>
					<img src='images/sde_metadata.png' alt='SDE' style='position: absolute; top: -30px; left: -30px; margin: 0px; border: none; max-width: none; max-height: none; z-index=10'/>
					<span class='fragment'>
						<img src='images/new_data_dictionary.png' alt='Data Dictionary' style='position: absolute; top: -20px; left: -20px; margin: 0px; border: none; max-width: none; max-height: none; z-index=20'/>
					</span>
					<span class='fragment'>
						<img src='images/new_data_maintenance.png' alt='Data Maintenance' style='position: absolute; top: -10px; left: -10px; margin: 0px; border: none; max-width: none; max-height: none; z-index=20'/>
					</span>
					<span class='fragment'>
						<img src='images/github_data.png' alt='GitHub' style='position: absolute; top: 0px; left: 0px; margin: 0px; border: none; max-width: none; max-height: none; z-index=20'/>
					</span>
					<span class='fragment'>
						<img src='images/agol_metadata.png' alt='ArcGIS Online' style='position: absolute; top: 10px; left: 10px; margin: 0px; border: none; max-width: none; max-height: none; z-index=20'/>
					</span>
					<span class='fragment'>
						<img src='images/agod_metadata.png' alt='ArcGIS Open Data' style='position: absolute; top: 20px; left: 20px; margin: 0px; border: none; max-width: none; max-height: none; z-index=20'/>
					</span>
					<span class='fragment'>
						<img src='images/socrata.png' alt='Socrata' style='position: absolute; top: 30px; left: 30px; margin: 0px; border: none; max-width: none; max-height: none; z-index=20'/>
					</span>
					<aside class="notes">
						<p>In the past year or so, it became and even bigger issue as we started to distribute our data in new
						ways.  In addition to our newly revamped online data dictionary and data maintenance pages, we were
						now putting data on GitHub, ArcGIS Online, and Socrata.  This left us with even more places that the 
						metadata needed to be edited. 
						</p>
					</aside>
				</section>

				<section>
					<img src='images/vision1.png' style='position:absolute; top: 0px; left: 0px; margin: 0px; max-width: none; max-height: none;' />
					<span class='fragment'>
						<img src='images/vision2.png' style='position:absolute; top: 0px; left: 0px; margin: 0px; max-width: none; max-height: none;' />
					</span>
					<span class='fragment'>
						<img src='images/vision3.png' style='position:absolute; top: 0px; left: 0px; margin: 0px; max-width: none; max-height: none;' />
					</span>
					<span class='fragment'>
						<img src='images/vision4.png' style='position:absolute; top: 0px; left: 0px; margin: 0px; max-width: none; max-height: none;' />
					</span>
					<span class='fragment'>
						<img src='images/vision5.png' style='position:absolute; top: 0px; left: 0px; margin: 0px; max-width: none; max-height: none;' />
					</span>
					<span class='fragment'>
						<img src='images/vision6.png' style='position:absolute; top: 0px; left: 0px; margin: 0px; max-width: none; max-height: none;' />
					</span>
					<aside class='notes'>
						<p>We started to think about how we could edit the metadata once and distribute it from that central
						point like we do with the data itself.  The most logical starting point was also the starting point
						for the data - ArcSDE.
						</p>
					</aside>
				</section>

				<section>
				<h3>Metadata XML</h3>
					<pre><code data-trim class="xml" style='height:100%'>
<metadata>
    ...
    <descript>
      <abstract>This data set derives from several sources. The...</abstract>
      <purpose>Updated parcel layer with the 2014 land use data.</purpose>
    </descript>					
      ...
      <attr>
        <attrlabl>ML</attrlabl>
        <attrdef>Map-Lot: This a unique parcel identifier found in...</attrdef>
      </attr>
  ...
</metadata>
					</code></pre>
					<aside class='notes'>
						<p>Metadata is stored in the SDE database in XML format.  Our thought was that we could write code to
						extract and parse this XML and use the contents to populate the metadata in other locations.
						</p>
					</aside>
				</section>

				<section>
				<h3>GitHub Export</h3>
				  <pre><code data-trim class="python" style='height:100%'>
installDir = arcpy.GetInstallInfo("desktop")["InstallDir"]
translator = installDir + "Metadata/Translator/ARCGIS2FGDC.xml"

source = database + schema + featureClass
if featureDataset != '':
    source = database + schema + featureDataset + "/" + source

dest = dest_root + "\\" + dest_path + "\\" + dest_name

if not arcpy.Exists(source):
    print "ERROR: " + source + " Not Found"
else:
    arcpy.gp.esri2open_esri2open(source, dest + ".geojson", "Default")
    arcpy.ExportMetadata_conversion(source, translator, dest + ".xml")
	                </code></pre>
					<aside class="notes">
					<p>GitHub was the low hanging fruit, so we tackled that first.  We are providing the metadata on GitHub
					in XML format, so we simply export the XML a GP tool when we are exporting the data.
					</p>
					</aside>
                </section>

				<section>
					<img src='images/github_xml.png' alt='GitHub XML' />
					<aside class="notes">
						<p>On GitHub, the XML metadata file is just stored alongside the data.
						</p>
					</aside>
				</section>

				<section>
					<img src='images/arc-open_markdown.png' alt='GitHub XML' />
					<aside class="notes">
					<p>The City of Philadelphia has taken this one step further and created ta tool they call
					<a href='https://github.com/CityOfPhiladelphia/arc-open' target='_blank'>Arc-Open</a>, which
					creates a GitHub standard Markdown file to add rich text formatting to their GitHub data.  This
					is an upgrade we may consider in the future.
					</p>
				</section>

				<section>
					<h3>Data Dictionary</h3>
					<img src='images/data_dictionary_process.png' alt='Data Dictionary' />
					<aside class='notes'>
						<p>The next output destination for our metadata is our GIS Data Dictionary on our website.  The 
						process we are using for this one is more complex and is tied tightly to our content management 
						system (CMS), but the concepts should work for any HTML output target.
						</p>
						<p>We have a configuration table that specifies some source and destination information for each
						data set.  We loop through each data set and use eXtensible Stylesheet Language Transformation (XSLT) 
						to translate the sections of the XML metadata that we need to the proper HTML tags for our data 
						dictionary pages.
						</p>
					</aside>
				</section>

				<section>
					<h3>Configuration Table</h3>
					<table class='gridtable'>
						<thead>
							<tr>
								<th>Source Dataset</th>
								<th>Source Name</th>
								<th>Destination Name</th>
								<th>Destination Path</th>
								<th>On GitHub</th>
								<th>In Data Dictionary</th>
								<th>Updated</th>
							</tr>
							<tr>
								<td>CDD_Zoning</td>
								<td>ZoningDistricts</td>
								<td>CDD_ZoningDistricts</td>
								<td>CDD\Zoning_Districts</td>
								<td>1</td>
								<td>1</td>
								<td>1</td>
							</tr>
							<tr>
								<td> </td>
								<td>LANDMARK_ElderlyFacilities</td>
								<td>LANDMARK_ElderlyFacilities</td>
								<td>Landmark\Elderly_Facilities</td>
								<td>1</td>
								<td>1</td>
								<td>1</td>
							</tr>
							<tr>
								<td> </td>
								<td>RECREATION_CommunityGardens</td>
								<td>RECREATION_CommunityGardens</td>
								<td>Recreation\Community_Gardens</td>
								<td>1</td>
								<td>1</td>
								<td>1</td>
							</tr>
							<tr>
								<td> </td>
								<td>UrbanForestry_Trees</td>
								<td>DPW_StreetTrees</td>
								<td>DPW\Trees</td>
								<td>1</td>
								<td>1</td>
								<td>1</td>
							</tr>
						</tbody>
					</table>
					<aside class='notes'>
						<p>The configuration table is used to set the source dataset and feature class and the destination
						name and path for output.  This is the same configuration table we use for our GitHub data and
						metadata export, so there are columns to allow each layer to be in one or the other or both.  The
						last column lets us know if the data and/or metadata has been updated and needs to be re-exported.
					    </p>
					</aside>
				</section>

				<section>
					<h3>SQL Access to SDE Metadata</h3>
					<pre><code data-trim class='sql'>
SELECT Documentation
FROM sde.GDB_ITEMS
WHERE PhysicalName LIKE '%.RECREATION_OpenSpace'				  
	                </code></pre>
	                <aside class='notes'>
	                <p>The SQL query to get the metadata out of the SDE database is quite simple.  The metadata is stored as
	                a field in the GDB_ITEMS table, and the layer can be specified by its PhysicalName (the one that shows
	                up in ArcCatalog).
	                </p>
	                </aside>
				</section>

				<section>
					<h3>Sample of eXtensible Stylesheet Language Transformation (XSLT) File</h3>
					<pre><code class='xsl' data-trim>
<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
  <xsl:output method="html" omit-xml-declaration="yes"></xsl:output>
  <xsl:variable name="Upper" select="'ABCDEFGHIJKLMNOPQRSTUVWXYZ'"></xsl:variable>
  <xsl:variable name="Lower" select="'abcdefghijklmnopqrstuvwxyz'"></xsl:variable>
  <xsl:template match="metadata">
    <xsl:if test="count(Binary/Thumbnail/Data) > 0">
      <div class="right">
        <xsl:element name="img">
          <xsl:attribute name="src">data:image/jpeg;base64,<xsl:value-of select="Binary/Thumbnail/Data" /></xsl:attribute>
          <xsl:attribute name="width">350px</xsl:attribute>
        </xsl:element>
      </div>
    </xsl:if>
    ...
    </xsl:template>
    ...
</xsl:stylesheet>
	                </code></pre>
	                <aside class='notes'>
	                <p>The XSLT file contains the bulk of the information required to translate the metadata from XML into
	                HTML for our site.</p>
	                </aside>
	            </section>

				<section>
					<h3>Transformation in C#</h3>
					<pre><code class='csharp' data-trim>
//do the transformation
XslCompiledTransform xslt = new XslCompiledTransform();
xslt.Load(Settings.GetSetting("GisDataDictionary.XslFileLoc"));
StringWriter sW = new StringWriter();
using (XmlWriter xmlW = XmlWriter.Create(sW, xslt.OutputSettings))
{
       xslt.Transform(xmlR, null, xmlW);
       returnValue = sW.ToString();
}
	                </code></pre>
	                <aside>
	                	<p>Whith the XSLT file in place, the actual C# code for the translation becomes very short, using
	                	the .NET XslCompiledTransform() object.
	                	</p>
	                </aside>
				</section>

				<section>
					<a target='_blank' href='http://www.cambridgema.gov/GIS/gisdatadictionary.aspx'>
					<img src='images/new_data_dictionary.png' alt='Data Dictionary' /></a>

					<aside class='notes'><p>This is an example of the final result - our GIS Data Dictionary pages with
					the content automatically generated from the SDE metadta.
					</p>
				    </aside>
				</section>

				<section>
					<h3>ArcGIS Online</h3>
					<img src='images/agol_process.png' alt='ArcGIS Online Process' />
					<aside class='notes'>
						<p>The ArcGIS Online process is a little different.  Here we are using the ArcGIS Online REST API to
						update the item's information page.  Since we are not really going from one XML-based format to 
						another in this case, we do not use XSLT.  Instead we are parsing the XML in Python to pull out the
						parts we need and using that information to generate the AGOL REST calls.  We use the same configuration talbe that is used for the other outputs.</p>
					</aside>
				</section>

				<section>
					<p>AGOL - show REST calls used</p>
				</section>

				<section>
				  <h3>Updating the item</h3>
				  <pre><code data-trim class='python'>
def updateItemDescription(userID, folderID, itemID, portalURL, token=None, snippet, tags):
    '''Update the item descriptive information.'''
    params = {
        'snippet': snippet,         # Summary
        'description': description, # Includes HTML attrib table
        'tags' : tags,
        'token' : token,
        'f': 'json'
    }
    requestURL = portalURL + '/sharing/rest/content/users/' + userID + '/' + \
                 folderID + '/items/' + itemID + '/update'
    print requestURL
    f = urllib.urlopen(requestURL, urllib.urlencode(params));
    results = f.read();
    print results
    return results
				  </code></pre>
				  <aside class="notes">
				  	<p>This function is used to update the descriptive information (metadata) for an AGOL item.  There is some
				  	prep work that needs to go into setting up the inputs that is not shown here.  In particular, the three 
				  	ID values must be acquired for the given data set.  These can all be obtained from an AGOL REST query
				  	that returns item infromation given the data set name.</p>
				  	<P>One other thing to note here is that the description field can take certain HTML tags for formatting
				  	the output.  We are using the various table tags to make the attribute table.</p>
				  </aside>
				</section>

				<section>
					<img src='images/agol_metadata.png' alt='ArcGIS Online Metadata' style='position:absolute; top: 0px; left: 0px; margin: 0px; max-width: none; max-height: none;'/>

					<span class='fragment'>
						<img src='images/agod_metadata.png' alt='ArcGIS for Open Data Metadata' style='position:absolute; top: 10px; left: 10px; margin: 0px; max-width: none; max-height: none;' />
					</span>

					<aside class='notes'>
						<p>This is what the resulting Item Detail looks like on AGOL.  The same information is passed through
						to ArcGIS for Open Data.
						</p>
					</aside>
				</section>

				<section>
					<img src='images/socrata_metadata.png' alt='Socrata Metadata' />
					<aside class='notes'>
						<p>At the moment, Socrata is the only platform that we don't have a solution for at all.  There is
						talk of a major update coming in the spring of 2015 that may have some promise, but until then the
						metadata on Socrata needs to be updated by hand.
						</p>
					</aside>
				</section>

				<section>
					<h1>More Info</h1>
					<h2>Me</h2>
					<p>Email: ssweeney@cambridgema.gov</p>
					<p>Twitter: @hiker4k</p>
					<p>GitHub: seansweeney</p>
					<p>These Slides: <a target='_blank' href='http://bit.ly/nearc2014sweeney'>http://bit.ly/nearc2014sweeney</a></p>
					<h2>Us</h2>
					<p>Web: <a target='_blank' href='http://cambridgema.gov/gis'>http://cambridgema.gov/gis</a></p>
					<p>Twitter: @CambridgeGIS</p>
				</section>

			</div>

		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.min.js"></script>

		<script>

			// Full list of configuration options available here:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: false,
				slideNumber: true,

//				theme: Reveal.getQueryHash().theme || 'default', // available themes are in /css/theme
				transition: Reveal.getQueryHash().transition || 'fade', // default/cube/page/concave/zoom/linear/fade/none

				// Parallax scrolling
				parallaxBackgroundImage: 'images/Map-of-Middle-Earth-lord-of-the-rings-2329809-1600-1200.jpg',
				parallaxBackgroundSize: '1600px 1200px',

				// Optional libraries used to extend on reveal.js
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
					{ src: 'plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
				]
			});

		</script>

	</body>
</html>
